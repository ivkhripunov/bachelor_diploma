\subsection{Обработка измерений}
Существует два качественно разных подхода к обработке поступающих измерений
для уточнения параметров орбиты.
Первый подход базируется на совместной обработке измерительной информации. 
Представителем данного подхода является метод наименьших квадратов (МНК).
На начальных этапах освоения космоса именно этот метод использовался
для восстановления орбит КА. 
С увеличением числа объектов в околоземном пространстве рос и объем ресурсов, 
требующийся для процедуры уточнения орбит.
Это привело к появлению менее трудоемких алгоритмов, основанных 
на линеаризации уравнений динамики системы и рекуррентной обработке измерений. Примером таких
алгоритмов служит фильтр Калмана и его модификации.

\subsubsection{Метод наименьших квадратов}
В методе наименьших квадратов параметры орбиты $\mathbf{x}$ итеративно 
подбираются таким образом,
чтобы минимизировать взвешенную сумму квадратов невязок измерений 
$\{\mathbf{z}^O_k (t_k, \mathbf{x})\}_{k=1}^N$ 
и их расчетных аналогов $\{\mathbf{z}_k^C (t_k, \mathbf{x})\}_{k=1}^N$:

\begin{equation}
    S(\mathbf{x}) = \sum_{k=1}^{N} (\mathbf{z}^O_k - \mathbf{z}^C_k)^T W_k 
    (\mathbf{z}^O_k - \mathbf{z}^C_k) \rightarrow min,
\end{equation}
где $N$ -- число измерений, $W_k$ -- весовая симметричная матрица, $t_k$ -- момент измерения, а
расчетные аналоги строятся из прогноза движения КА на моменты измерений.

Задачу оптимизации можно переписать в виде:

\begin{equation*}
    S(\mathbf{x}) = (\mathbf{z}^O - \mathbf{z}^C)^T W (\mathbf{z}^O - \mathbf{z}^C) \rightarrow min,
\end{equation*}
где $z^C = (z_1^C, \dots, z_N^C)$, $z^O = (z_1^O, \dots, z_N^O)$, $W = diag(W_1, \dots, W_N)$.

Рассмотрим поиск минимума функционала методом Гаусса-Ньютона, также
известным как метод дифференциальной коррекции. В данном алгоритме 
используется предположение о близости начального приближения к оптимальному, что позволяет
провести линеаризацию расчетного аналога измерений:

\begin{equation*}
    \mathbf{z}^C = \mathbf{z}^N (\mathbf{x}) +  
    \frac{\partial \mathbf{z}^N (\mathbf{x})}{\partial \mathbf{x}} \Delta \mathbf{x} = 
    \mathbf{z}^N + A \Delta \mathbf{x},
\end{equation*}
где $\mathbf{z}^N$ -- номинальный вектор измерений, соответствующий состоянию системы на текущей итерации,
 $A (\mathbf{x}) = \frac{\partial z^N (\mathbf{x})}{\partial \mathbf{x}}$ -- матрица Якоби,
 $\Delta \mathbf{x}$ -- параметр линеаризации.

На каждой итерации необходимо найти такой шаг $\Delta \mathbf{x}$, который обеспечивал бы
минимум невязки. Из необходимого условия экстремума:

\begin{equation*}
    \nabla S(\mathbf{x}) = - 2 A^T (\mathbf{x}) W (\mathbf{z}^O (\mathbf{x}) - \mathbf{z}^C) = 0
\end{equation*}

\begin{equation*}
    A^T W (\mathbf{z}^O - \mathbf{z}^C) 
    = A^T W (\mathbf{z}^O - \mathbf{z}^N) - A^T W A \Delta \mathbf{x} = 0
\end{equation*}

Обозначая $\mathbf{z}^O - \mathbf{z}^N = \mathbf{b}$, получим выражение для шага:
\begin{equation}
    \Delta \mathbf{x} = (A^T W A)^{-1} A^T W \mathbf{b}
\end{equation}

Таким образом, имея начальное приближение $\mathbf{x}_{0}$, можно построить итеративную процедуру:
\begin{equation}
    \mathbf{x}_{i + 1} = \mathbf{x}_{i} + \Delta \mathbf{x}
\end{equation}

Выбор начального приближения может быть осуществлен с помощью методов начального
определения орбиты, таких как методы Гаусса, Гудинга и Double-R.

Критерий останова -- малое изменение среднеквадратичного отклонения по сравнению с предыдущей итерацией.

Матрица Якоби $A_k$ измерения $\mathbf{z}_k$ представима в виде произведения:

\begin{equation*}
    A_k(\mathbf{x}) = \frac{\partial \mathbf{z}_k (\mathbf{\tilde{x}})}{\partial \mathbf{\tilde{x}}}
    \frac{\partial \mathbf{\tilde{x}} (\mathbf{x}, t_k)}{\partial \mathbf{x}} = H_k \Phi_k,
\end{equation*}
где $\mathbf{\tilde{x}}$ -- прогноз состояния системы на момент времени $t_k$, 
а матрица $H_k$ может быть рассчитана аналитически.

Матрица изохронных производных $\Phi_k$ вычисляется 
из интегрирования уравнения в вариациях до момента времени $t_k$:
\begin{equation}
    \begin{cases}
        \dot{\Phi} = \frac{\partial \mathbf{f}}{\partial \mathbf{x}} \Phi, \\
        \Phi \big|_{t = t_0} = E,
        \label{eq:prognoz_phi}
    \end{cases}
\end{equation}
где $\mathbf{f}$ -- правая часть системы (\ref{eq:prognoz_task}), $E$ -- единичная матрица.

МНК требует точную, а следовательно вычислительно-затратную модель эволюции системы, но
взамен дает высокую точность определения орбиты и согласующих параметров (например,
отношения площади КА к массе).

\subsubsection{Фильтр Калмана}
Фильтр Калмана -- рекурсивный фильтр, использующий модель движения системы и
измерения датчиков (в том числе и с зашумлением) для оценки вектора состояния системы.

Каждая итерация фильтра включает прогноз на основе текущего состояния и уточнение прогноза
с учетом измерения. Исходно Фильтр Калмана создавался для линейных систем. Задачи
баллистики существенно нелинейны, поэтому для их решения были разработаны 
расширенный и сигма-точечный фильтр Калмана. 

Рассмотрим динамическую систему со следующей моделью:

\begin{equation*}
    \begin{cases}
        \dot{\mathbf{x}}(t) = \mathbf{f}(\mathbf{x}(t), t) + \mathbf{w}(t), \\
        \mathbf{x}(t_0) \sim \mathcal{N}\left(\bar{\mathbf{x}}_0, P_0 \right),
    \end{cases}
\end{equation*}
где $\mathbf{w}(t)$ -- вектор шума модели с матрицей ковариации Q.

С помощью датчика можно получать измерения параметров системы $\mathbf{z}_k$ в моменты времени $t_k$:

\begin{equation*}
    \mathbf{z}_k = \mathbf{h} (\mathbf{x}(t_k), t_k) + \mathbf{v}_k,
\end{equation*}
где $\mathbf{h} (\mathbf{x}, t)$ -- функция чувствительности системы, $\mathbf{v}_k$ --
нормально распределенный шум измерения с нулевым математическим ожиданием и матрицей
ковариации $R_k$. Предполагается, что шумы $w$ и $v$ не коррелируют.

Задача фильтрации заключается в рекурсивном вычислении оптимальной оценки состояния
по набору измерений $\{\mathbf{z}_k\}_{k=1}^N$. 

\paragraph{Расширенный фильтр Калмана.}
В основе расширенного фильтра Калмана линеаризация в окрестности отфильтрованной
оценки состояния системы на каждом шаге. Прогноз вектора состояния до коррекции
производится по формуле:

\begin{equation*}
    \mathbf{x}_{k|k-1} = \mathbf{x}_{k-1|k-1} 
    + \Delta t \cdot \mathbf{f} (\mathbf{x}_{k-1|k-1}, t_{k-1})
\end{equation*}

Затем вычисляется прогноз матрицы ковариации, и оба прогноза корректируются с учетом 
следующего измерения.

Учитывая процедуру линеаризации, использование высокоточной модели движения в
фильтре Калмана нецелесообразно. Упрощенная модель динамики и рекуррентная обработка
измерений приводит к низкой ресурсоемкости процесса фильтрации, что особенно важно
для бортовых вычислительных систем. Однако недостаток линеаризации выражается в значительном
росте ошибок на больших промежутках времени.

\paragraph{Сигма-точечный фильтр Калмана}
Вместо линеаризации эта модификация фильтра Калмана использует сигма-точки,
расположенные в окрестности текущей оценки состояния. Эти точки "пробуют" возможные
варианты развития системы, а потом объединяются для уточненного прогноза:

\begin{equation*}
    \mathbf{x}_{k|k-1} = \sum_{i = 0}^{2n} W_i^{(m)} \mathbf{x}^{*}_{i, k-1|k-1}
\end{equation*}